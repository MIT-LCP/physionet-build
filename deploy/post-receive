#!/bin/bash

set -e

destination=/physionet/physionet-build/
branch=$(cat /physionet/deploy-branch) # production or staging

echo "Deploying $branch into $destination"
GIT_WORK_TREE=$destination git checkout --force $branch

echo "Updating content"
export DJANGO_SETTINGS_MODULE=physionet.settings.$branch
cd $destination
source /physionet/python-env/physionet/bin/activate
pip install -r requirements.txt
cd physionet-django
python manage.py collectstatic --noinput
touch physionet/wsgi.py

echo "Done. If there are any database changes, please make the migrations now."
