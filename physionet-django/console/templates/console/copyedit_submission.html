{% extends "console/base_console.html" %}

{% load static %}

{% block title %}Copyedit Submission{% endblock %}

{% block local_css %}
<link rel="stylesheet" type="text/css" href="{% static 'project/css/submission-timeline.css' %}">
{% endblock %}

{% block local_js_top %}
<script type="text/javascript" src="{% static 'custom/js/cookie.js' %}"></script>
<script type="text/javascript" src="{% static 'project/js/dynamic-formset.js' %}"></script>
<script type="text/javascript" src="{% static 'custom/js/copy-to-clipboard.js' %}"></script>
{% endblock %}

{% block content %}
<h1>Copyedit Project: {{ project }}</h1>
<hr>
{% include "console/submission_info_card.html" %}

<div class="card">
  <div class="card-header">
    <ul class="nav nav-tabs card-header-tabs">
      <li class="nav-item">
        <a class="nav-link active" id="files-tab" data-toggle="tab" href="#files" role="tab" aria-controls="files" aria-selected="false">Edit Files</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" id="metadata-tab" data-toggle="tab" href="#metadata" role="tab" aria-controls="metadata" aria-selected="true">Edit Metadata</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" id="complete-tab" data-toggle="tab" href="#complete" role="tab" aria-controls="complete" aria-selected="false">Complete Copyedit</a>
      </li>
    </ul>
  </div>
  <div class="card-body">
    {# Edit Metadata #}
    <div class="tab-content" id="tabContent">
      {# Edit Files #}
      <div class="tab-pane fade show active" id="files" role="tabpanel" aria-labelledby="files-tab">
        <div class="card">
          <div class="card-body">
            <h4 class="card-title">Storage Allowance: {{ storage_info.readable_allowance }}</h4>
            <p class="card-text">Used: {{ storage_info.readable_used }} ( {{ storage_info.p_used }}% ) <a style="float:right">Remaining: {{ storage_info.readable_remaining }} ( {{ storage_info.p_remaining }}% )</a></p>
            <div class="progress">
              <div class="progress-bar progress-bar-striped" role="progressbar" style="width: {{ storage_info.p_used }}%;" aria-valuenow="{{ storage_info.p_used }}" aria-valuemin="0" aria-valuemax="100">
              </div>
            </div>
          </div>
        </div>
        <br>
        {% include "project/project_files_panel.html" %}
      </div>
      <div class="tab-pane fade" id="metadata" role="tabpanel" aria-labelledby="metadata-tab">
        <form action="" method="post">
          <h3>Description</h3>
          {{ description_form.media }}
          {% include "project/metadata_inline_form_snippet.html" with form=description_form %}
          {% include 'project/item_list.html' with item="reference" item_label=reference_formset.item_label formset=reference_formset form_name=reference_formset.form_name add_item_url=add_item_url remove_item_url=remove_item_url %}
          <h3>Access</h3>
          {% include "project/metadata_inline_form_snippet.html" with form=access_form %}
          <h3>Discovery</h3>
          {% include "project/metadata_inline_form_snippet.html" with form=discovery_form %}
          {% include 'project/item_list.html' with item="publication" item_label=publication_formset.item_label formset=publication_formset form_name=publication_formset.form_name add_item_url=add_item_url remove_item_url=remove_item_url %}
          {% include 'project/item_list.html' with item="topic" item_label=topic_formset.item_label formset=topic_formset form_name=topic_formset.form_name add_item_url=add_item_url remove_item_url=remove_item_url %}
          <button class="btn btn-lg btn-primary" type="submit" name="edit_metadata">Save Metadata</button>
        </form>
      </div>
      {# Complete Copyedit #}
      <div class="tab-pane fade" id="complete" role="tabpanel" aria-labelledby="complete-tab">
        <p>When you are satisfied with the final state of the project, you
           may complete this step. If you made any changes, summarize them
           below.</p>
        <form action="" method="post">
          {% csrf_token %}
          {% include "form_snippet.html" with form=copyedit_form %}
          <button class="btn btn-lg btn-primary" type="submit" name="complete_copyedit">Complete Copyedit</button>
        </form>
      </div>
    </div>
  </div>
</div>


{% endblock %}

{% block local_js_bottom %}
<script type="text/javascript" src="{% static 'custom/js/resize-ck.js' %}"></script>
<script type="text/javascript" src="{% static 'custom/js/enable-popover.js' %}"></script>
<script type="text/javascript" src="{% static 'project/js/control-access-form.js' %}"></script>
<script>
  load_url = "{% url 'load_license' project.slug %}"
  access_policy_input = document.getElementById("id_access_policy");
  access_policy_input.onchange = loadLicense;
</script>
<script>disableAddButtons();</script>
{% endblock %}
